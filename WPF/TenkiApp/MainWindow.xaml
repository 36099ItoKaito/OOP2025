<Window x:Class="TenkiApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="天気予報 - Tenki Weather" Height="850" Width="1500"
        WindowStartupLocation="CenterScreen"
        Background="#0a0e27">

    <Window.Resources>

        <!-- グラデーションボタン -->
        <Style x:Key="GradientButton" TargetType="Button">
            <Setter Property="Background">
                <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="#6C5CE7" Offset="0"/>
                        <GradientStop Color="#A29BFE" Offset="1"/>
                    </LinearGradientBrush>
                </Setter.Value>
            </Setter>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="12"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#7d6ef7" Offset="0"/>
                                            <GradientStop Color="#b3acfe" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#6C5CE7" Opacity="0.6" BlurRadius="20" ShadowDepth="0"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background">
                                    <Setter.Value>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#5b4cd7" Offset="0"/>
                                            <GradientStop Color="#918bee" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- モダン検索ボックス -->
        <Style x:Key="ModernSearchBox" TargetType="TextBox">
            <Setter Property="Background" Value="#1a1f3a"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#6C5CE7"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="12">
                            <Grid>
                                <ScrollViewer x:Name="PART_ContentHost"
                                              Margin="{TemplateBinding Padding}"
                                              VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#A29BFE"/>
                                <Setter TargetName="border" Property="Effect">
                                    <Setter.Value>
                                        <DropShadowEffect Color="#6C5CE7" Opacity="0.5" BlurRadius="15" ShadowDepth="0"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="#8479E1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 改良された都市カード -->
        <Style x:Key="ModernCityCard" TargetType="Border">
            <Setter Property="Background" Value="#1a1f3a"/>
            <Setter Property="CornerRadius" Value="18"/>
            <Setter Property="Padding" Value="18"/>
            <Setter Property="Width" Value="190"/>
            <Setter Property="Height" Value="170"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#2d3561"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="#000000" Opacity="0.3" BlurRadius="10" ShadowDepth="3"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 時間予報カード -->
        <DataTemplate x:Key="HourlyForecastTemplate">
            <Border Background="#1a1f3a" 
                    CornerRadius="15" 
                    Padding="18,12" 
                    Margin="6" 
                    Width="110"
                    BorderThickness="1"
                    BorderBrush="#2d3561">
                <Border.Effect>
                    <DropShadowEffect Color="#000000" Opacity="0.2" BlurRadius="8" ShadowDepth="2"/>
                </Border.Effect>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="{Binding Time}" 
                               FontSize="14" 
                               FontWeight="SemiBold" 
                               Foreground="#A29BFE" 
                               HorizontalAlignment="Center"
                               Margin="0,0,0,8"/>
                    <TextBlock Text="{Binding Weather}" 
                               FontSize="36" 
                               HorizontalAlignment="Center"
                               Margin="0,5"/>
                    <TextBlock Text="{Binding Temperature}" 
                               FontSize="18" 
                               FontWeight="Bold" 
                               Foreground="White" 
                               HorizontalAlignment="Center"
                               Margin="0,5,0,0"/>
                    <TextBlock Text="{Binding Precipitation}" 
                               FontSize="12" 
                               Foreground="#74b9ff" 
                               HorizontalAlignment="Center" 
                               Margin="0,5,0,0"/>
                </StackPanel>
            </Border>
        </DataTemplate>

    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>


        <!-- ======== 左パネル：都市カード一覧 ======== -->
        <Border Grid.Column="0" 
                Margin="0,0,10,0" 
                CornerRadius="25"
                BorderThickness="1"
                BorderBrush="#1a1f3a">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#141829" Offset="0"/>
                    <GradientStop Color="#0f1424" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect Color="#000000" Opacity="0.4" BlurRadius="20" ShadowDepth="5"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- ヘッダー -->
                <StackPanel Grid.Row="0" Margin="30,30,30,15">
                    <TextBlock Text="🌤️ 天気予報"
                               FontSize="28"
                               FontWeight="Bold"
                               Foreground="White">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="#6C5CE7" Opacity="0.3" BlurRadius="10" ShadowDepth="0"/>
                        </TextBlock.Effect>
                    </TextBlock>
                    <TextBlock x:Name="DateText"
                               Text="今日の天気"
                               FontSize="15"
                               Foreground="#A29BFE"
                               Margin="0,6,0,0"
                               Opacity="0.9"/>
                </StackPanel>

                <!-- 検索バー -->
                <Grid Grid.Row="1" Margin="30,10,30,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="SearchTextBox"
                             Style="{StaticResource ModernSearchBox}"
                             Text="都市名で検索..."
                             GotFocus="SearchTextBox_GotFocus"
                             LostFocus="SearchTextBox_LostFocus"
                             TextChanged="SearchTextBox_TextChanged"
                             KeyDown="SearchTextBox_KeyDown"/>

                    <Button Grid.Column="1"
                            Style="{StaticResource GradientButton}"
                            Margin="12,0,0,0"
                            Width="65"
                            Click="SearchButton_Click"
                            ToolTip="検索">
                        <Viewbox Width="20" Height="20">
                            <Canvas Width="24" Height="24">
                                <Path Data="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
                                      Fill="White"/>
                            </Canvas>
                        </Viewbox>
                    </Button>
                </Grid>

                <!-- お気に入りセクション -->
                <StackPanel Grid.Row="2" Margin="30,10,30,8">
                    <TextBlock Text="📍 主要都市"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="#E8EAED"/>
                </StackPanel>

                <!-- 都市カード一覧 -->
                <ScrollViewer Grid.Row="3" 
                              VerticalScrollBarVisibility="Auto" 
                              Margin="20,5,20,20"
                              Padding="5">
                    <WrapPanel x:Name="CityCardsPanel"/>
                </ScrollViewer>

            </Grid>
        </Border>


        <!-- ======== 右パネル：詳細天気情報 ======== -->
        <Border Grid.Column="1" 
                Margin="10,0,0,0" 
                CornerRadius="25"
                BorderThickness="1"
                BorderBrush="#1a1f3a">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#141829" Offset="0"/>
                    <GradientStop Color="#0f1424" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect Color="#000000" Opacity="0.4" BlurRadius="20" ShadowDepth="5"/>
            </Border.Effect>
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="35">

                    <!-- 都市名 -->
                    <TextBlock x:Name="CityNameText"
                               Text="都市を選択してください"
                               FontSize="40"
                               FontWeight="Bold"
                               Foreground="White"
                               Margin="0,0,0,25">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="#6C5CE7" Opacity="0.3" BlurRadius="10" ShadowDepth="0"/>
                        </TextBlock.Effect>
                    </TextBlock>

                    <!-- 現在の天気カード -->
                    <Border CornerRadius="25" Padding="35" Margin="0,0,0,30">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#6C5CE7" Offset="0"/>
                                <GradientStop Color="#A29BFE" Offset="0.5"/>
                                <GradientStop Color="#74b9ff" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <Border.Effect>
                            <DropShadowEffect Color="#6C5CE7" Opacity="0.4" BlurRadius="25" ShadowDepth="0"/>
                        </Border.Effect>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <TextBlock Text="現在の天気"
                                           FontSize="18"
                                           Foreground="White"
                                           Opacity="0.85"
                                           Margin="0,0,0,12"
                                           FontWeight="Medium"/>

                                <TextBlock x:Name="WeatherDescText"
                                           Text="--"
                                           FontSize="32"
                                           FontWeight="SemiBold"
                                           Foreground="White"
                                           Margin="0,0,0,18"/>

                                <TextBlock x:Name="CurrentTempText"
                                           Text="--°C"
                                           FontSize="64"
                                           FontWeight="Bold"
                                           Foreground="White">
                                    <TextBlock.Effect>
                                        <DropShadowEffect Color="#000000" Opacity="0.3" BlurRadius="10" ShadowDepth="2"/>
                                    </TextBlock.Effect>
                                </TextBlock>
                            </StackPanel>

                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="40,0,0,0">
                                <Border Background="#FFFFFF" 
                                        CornerRadius="18" 
                                        Padding="25,18" 
                                        Margin="0,0,0,15">
                                    <Border.Effect>
                                        <DropShadowEffect Color="#000000" Opacity="0.2" BlurRadius="10" ShadowDepth="3"/>
                                    </Border.Effect>
                                    <StackPanel>
                                        <TextBlock Text="🔥" FontSize="28" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                        <TextBlock x:Name="MaxTempText" 
                                                   Text="--°C" 
                                                   Foreground="#ff6b6b" 
                                                   FontSize="20" 
                                                   FontWeight="Bold" 
                                                   HorizontalAlignment="Center"/>
                                        <TextBlock Text="最高" 
                                                   Foreground="#636e72" 
                                                   FontSize="12" 
                                                   HorizontalAlignment="Center"
                                                   Margin="0,3,0,0"/>
                                    </StackPanel>
                                </Border>
                                <Border Background="#FFFFFF" 
                                        CornerRadius="18" 
                                        Padding="25,18">
                                    <Border.Effect>
                                        <DropShadowEffect Color="#000000" Opacity="0.2" BlurRadius="10" ShadowDepth="3"/>
                                    </Border.Effect>
                                    <StackPanel>
                                        <TextBlock Text="❄️" FontSize="28" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                                        <TextBlock x:Name="MinTempText" 
                                                   Text="--°C" 
                                                   Foreground="#4ecdc4" 
                                                   FontSize="20" 
                                                   FontWeight="Bold" 
                                                   HorizontalAlignment="Center"/>
                                        <TextBlock Text="最低" 
                                                   Foreground="#636e72" 
                                                   FontSize="12" 
                                                   HorizontalAlignment="Center"
                                                   Margin="0,3,0,0"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- 詳細情報グリッド -->
                    <Grid Margin="0,0,0,30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" 
                                Background="#1a1f3a" 
                                CornerRadius="18" 
                                Padding="25" 
                                Margin="0,0,12,0"
                                BorderThickness="1"
                                BorderBrush="#2d3561">
                            <Border.Effect>
                                <DropShadowEffect Color="#000000" Opacity="0.2" BlurRadius="8" ShadowDepth="2"/>
                            </Border.Effect>
                            <StackPanel>
                                <TextBlock Text="💧 湿度" 
                                           FontSize="15" 
                                           Foreground="#A29BFE" 
                                           Margin="0,0,0,8"
                                           FontWeight="Medium"/>
                                <TextBlock x:Name="HumidityText" 
                                           Text="--%" 
                                           FontSize="28" 
                                           FontWeight="Bold" 
                                           Foreground="White"/>
                            </StackPanel>
                        </Border>

                        <Border Grid.Column="1" 
                                Background="#1a1f3a" 
                                CornerRadius="18" 
                                Padding="25" 
                                Margin="12,0,0,0"
                                BorderThickness="1"
                                BorderBrush="#2d3561">
                            <Border.Effect>
                                <DropShadowEffect Color="#000000" Opacity="0.2" BlurRadius="8" ShadowDepth="2"/>
                            </Border.Effect>
                            <StackPanel>
                                <TextBlock Text="💨 風速" 
                                           FontSize="15" 
                                           Foreground="#A29BFE" 
                                           Margin="0,0,0,8"
                                           FontWeight="Medium"/>
                                <TextBlock x:Name="WindSpeedText" 
                                           Text="--m/s" 
                                           FontSize="28" 
                                           FontWeight="Bold" 
                                           Foreground="White"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- 24時間予報 -->
                    <TextBlock Text="⏰ 24時間の天気予報"
                               FontSize="24"
                               FontWeight="Bold"
                               Foreground="White"
                               Margin="0,10,0,20">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="#6C5CE7" Opacity="0.3" BlurRadius="8" ShadowDepth="0"/>
                        </TextBlock.Effect>
                    </TextBlock>

                    <ScrollViewer HorizontalScrollBarVisibility="Auto" 
                                  VerticalScrollBarVisibility="Disabled"
                                  Padding="0,0,0,10">
                        <ItemsControl x:Name="HourlyForecastList" ItemTemplate="{StaticResource HourlyForecastTemplate}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                        </ItemsControl>
                    </ScrollViewer>

                    <!-- ローディング表示 -->
                    <TextBlock x:Name="LoadingText"
                               Text=""
                               FontSize="17"
                               Foreground="#A29BFE"
                               HorizontalAlignment="Center"
                               Margin="0,30,0,0"
                               FontWeight="Medium"/>

                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- 検索結果ポップアップ -->
        <Popup x:Name="SearchResultsPopup"
               PlacementTarget="{Binding ElementName=SearchTextBox}"
               Placement="Bottom"
               StaysOpen="False"
               AllowsTransparency="True">
            <Border Background="#1a1f3a"
                    BorderBrush="#6C5CE7"
                    BorderThickness="2"
                    CornerRadius="15"
                    Padding="8"
                    Width="450"
                    MaxHeight="450">
                <Border.Effect>
                    <DropShadowEffect Color="#6C5CE7" Opacity="0.5" BlurRadius="25" ShadowDepth="0"/>
                </Border.Effect>
                <ListBox x:Name="SearchResultsList"
                         Background="Transparent"
                         BorderThickness="0"
                         Foreground="White"
                         SelectionChanged="SearchResultsList_SelectionChanged">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Padding" Value="12"/>
                            <Setter Property="Cursor" Value="Hand"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListBoxItem">
                                        <Border x:Name="border"
                                                Background="{TemplateBinding Background}"
                                                CornerRadius="10"
                                                Padding="{TemplateBinding Padding}"
                                                Margin="4,2">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#2d3561"/>
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#3d4571"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListBox.ItemContainerStyle>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="5">
                                <TextBlock Text="{Binding Name}" 
                                           FontSize="17" 
                                           FontWeight="Bold"
                                           Foreground="White"/>
                                <TextBlock Text="{Binding Prefecture}" 
                                           FontSize="13" 
                                           Foreground="#A29BFE"
                                           Margin="0,3,0,0"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>
        </Popup>

    </Grid>
</Window>